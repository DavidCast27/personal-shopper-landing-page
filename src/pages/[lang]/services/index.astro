---
import SiteLayout from "../../../layouts/SiteLayout.astro";
import ServicesBlock from "@/components/blocks/services-7.astro";
import EmptyState from "@/components/blocks/empty-state-1.astro";
import { getPage, getServices, getSiteSettings } from "@/lib/content";
import { renderMarkdown } from "@/lib/markdown";
import { t } from "@/lib/i18n";
import { staticPathsForLang, type Lang } from "@/lib/lang";

export const prerender = true;

export function getStaticPaths() { return staticPathsForLang() }

const placeholderImage = "/uploads/image-placeholder.daj0efyq_29eycw.webp";

const { lang } = Astro.params as { lang: Lang };
const services = await getServices(lang);
const page = await getPage(lang, 'services');
const fm = page.frontmatter as { title?: string; description?: string };
const site = await getSiteSettings(lang);
const cta = site?.header_cta_text && site?.header_cta_href ? [{ text: site.header_cta_text, href: site.header_cta_href }] : undefined;
const items = services.map((s) => ({
  id: s.slug,
  href: `/${lang}/services/${s.slug}`,
  title: s.title,
  description: s.description,
  image: {
    src: s.image || placeholderImage,
    alt: s.title,
    width: 256,
    height: 256,
  },
  links: cta,
}));
---

<SiteLayout
  lang={lang}
  title={fm.title}
  description={fm.description}
>
  <ServicesBlock items={items}>
    {fm.title && <h1>{fm.title}</h1>}
    {page.body && <div class="contents" set:html={renderMarkdown(page.body)} />}
  </ServicesBlock>
  {items.length === 0 && (
    <EmptyState
      icon="package-open"
      title={t(lang, 'empty.services.title')}
      description={t(lang, 'empty.services.description')}
    />
  )}
</SiteLayout>
