---
import {
  NativeSelect,
  NativeSelectOption,
} from "@/components/ui/native-select";

import { SUPPORTED, type Lang } from "@/lib/lang";
import { t } from "@/lib/i18n";

interface Props { lang: Lang; pathname: string }

const { lang, pathname } = Astro.props as Props;

function computeUrl(target: Lang) {
  // Expect paths like /en/..., /es/..., /fr/...
  const parts = pathname.split("/");
  const current = parts[1];
  if ((SUPPORTED as readonly string[]).includes(current as any)) {
    parts[1] = target;
    const next = parts.join("/");
    return next.endsWith("/") && next.length > 1 ? next.slice(0, -1) : next;
  }
  // Fallback to root for target
  return `/${target}`;
}

const items = SUPPORTED.map((code) => ({ code, label: code.toUpperCase() })) as { code: Lang; label: string }[];
---

<NativeSelect
  aria-label={t(lang, 'aria.lang_selector')}
  onchange="document.cookie='lang='+this.options[this.selectedIndex].dataset.code+'; Path=/; Max-Age=31536000; SameSite=Lax'; location.href=this.value"
>
  {
    items.map((i) => (
      <NativeSelectOption
        value={computeUrl(i.code)}
        selected={i.code === lang}
        data-code={i.code}
      >
        {i.label}
      </NativeSelectOption>
    ))
  }
</NativeSelect>
