---
import SiteLayout from "../../layouts/SiteLayout.astro";
import HeroBlock from "@/components/blocks/hero-3.astro";
import ServicesBlock from "@/components/blocks/services-7.astro";
import HowItWorks from "@/components/blocks/how-it-works-1.astro";
import CTABlock from "@/components/blocks/cta-8.astro";
import { getHome, getHowItWorks, getServices } from "@/lib/content";

const placeholderImage = "/uploads/image-placeholder.daj0efyq_29eycw.webp";

const home = await getHome("en");
const steps = await getHowItWorks("en");
const services = await getServices("en");
// Home content is normalized in lib/content.ts
---

<SiteLayout
  lang="en"
  title={home.title}
  description={home.description}
>
  <HeroBlock
    image={{
      src: home.hero_image || placeholderImage,
      alt: home.hero_image_alt,
      width: 256,
      height: 256,
    }}
    links={[
      { text: home.hero_cta_text, href: home.hero_cta_href },
      ...(home.hero_secondary_cta_text && home.hero_secondary_cta_href
        ? [{ text: home.hero_secondary_cta_text, href: home.hero_secondary_cta_href }]
        : []),
    ]}
  >
    <h1>{home.hero_title}</h1>
    <p>
      {
        home.hero_subtitle
      }
    </p>
  </HeroBlock>
  <ServicesBlock
    items={services.map((service) => ({
      href: `/en/services#${service.slug}`,
      title: service.title,
      description: service.description,
      image: {
        src: service.image || placeholderImage,
        alt: service.title,
        width: 256,
        height: 256,
      },
      links: home.services_cta_text && home.services_cta_href
        ? [{ text: home.services_cta_text, href: home.services_cta_href }]
        : undefined,
    }))}
  >
    {home.services_title && <h2>{home.services_title}</h2>}
    {home.services_description && <p>{home.services_description}</p>}
  </ServicesBlock>
  <HowItWorks
    title={home.steps_title}
    items={steps.map((s) => ({
      title: s.title,
      description: s.description,
      link_text: s.link_text,
      link_href: s.link_href,
    }))}
  />
  <CTABlock
    item={{
      rating: 5,
      description: home.cta_description,
      images: [
        { src: placeholderImage, alt: "" },
        { src: placeholderImage, alt: "" },
      ],
    }}
    links={home.cta_link_text && home.cta_link_href ? [{ text: home.cta_link_text, href: home.cta_link_href }] : undefined}
  >
    {home.cta_text && <p>{home.cta_text}</p>}
  </CTABlock>
</SiteLayout>
