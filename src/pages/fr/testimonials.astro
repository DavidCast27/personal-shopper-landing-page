---
import SiteLayout from "../../layouts/SiteLayout.astro";
import ReviewsBlock from "@/components/blocks/reviews-1.astro";
import EmptyState from "@/components/blocks/empty-state-1.astro";
import { getPage, getTestimonials } from "@/lib/content";
import { renderMarkdown } from "@/lib/markdown";

const placeholderImage = "/uploads/image-placeholder.daj0efyq_29eycw.webp";

const testimonials = await getTestimonials("fr");
const page = await getPage('fr', 'testimonials');
const fm = page.frontmatter as { title?: string; description?: string };
const items = testimonials.map((t) => ({
  title: t.title,
  description: t.body || "",
  rating: t.rating,
  item: {
    title: t.author,
    description: t.role,
    image: t.avatar ? { src: t.avatar } : { src: placeholderImage },
  },
}));
---

<SiteLayout
  lang="fr"
  title={fm.title}
  description={fm.description}
>
  <ReviewsBlock items={items}>
    {fm.title && <h1>{fm.title}</h1>}
    {page.body && <div class="contents" set:html={renderMarkdown(page.body)} />}
  </ReviewsBlock>
  {items.length === 0 && (
    <EmptyState
      icon="messages-square"
      title="Aucun témoignage pour le moment"
      description="Nous recueillons des avis. Revenez bientôt."
    />
  )}
</SiteLayout>
