---
import SiteLayout from "@/layouts/SiteLayout.astro";
import { getNotFound } from "@/lib/content";
import { Button } from "@/components/ui/button";
import {
  Empty,
  EmptyContent,
  EmptyDescription,
  EmptyHeader,
  EmptyMedia,
  EmptyTitle,
} from "@/components/ui/empty";
import { Icon } from "@/components/ui/icon";

const SUPPORTED = ["en", "es", "fr"] as const;
type Supported = (typeof SUPPORTED)[number];

function detectLang(pathname: string): Supported {
  const seg = pathname.split("/").filter(Boolean)[0] as string | undefined;
  if (seg && (SUPPORTED as readonly string[]).includes(seg)) return seg as Supported;
  return "en";
}

const lang = detectLang(Astro.url.pathname);
const notFound = await getNotFound(lang);
const title = `404 â€” ${notFound.title}`;
const description = notFound.description;
---

<SiteLayout title={title} description={description} lang={lang}>
  <main class="mx-auto flex min-h-[60vh] max-w-3xl items-center justify-center px-6">
    <Empty class="w-full">
      <EmptyHeader>
        <EmptyMedia variant="icon">
          <Icon name="file-question" />
        </EmptyMedia>
        <EmptyTitle>{notFound.title}</EmptyTitle>
        <EmptyDescription>
          {notFound.description}
        </EmptyDescription>
      </EmptyHeader>
      <EmptyContent>
        <Button size="sm" href={notFound.cta_href}>
          {notFound.cta_text}
        </Button>
      </EmptyContent>
    </Empty>
  </main>
</SiteLayout>
